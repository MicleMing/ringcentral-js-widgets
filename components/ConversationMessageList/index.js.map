{"version":3,"sources":["components/ConversationMessageList/index.js"],"names":["Message","subject","time","direction","sender","SubjectRenderer","subjectRenderer","mmsAttachment","content","contentType","indexOf","uri","styles","picture","message","messageBody","outbound","inbound","length","big","clear","propTypes","PropTypes","string","isRequired","func","object","defaultProps","undefined","ConversationMessageList","onScroll","_listRef","currentScrollTop","scrollTop","_scrollHeight","scrollHeight","clientHeight","_scrollTop","_scrollUp","props","loadPreviousMessages","scrollToLastMessage","previousProps","messages","className","dateTimeFormatter","showSender","height","messageSubjectRenderer","formatPhone","loadingNextPage","lastDate","messageList","map","from","name","extensionNumber","phoneNumber","date","Date","creationTime","getHours","utcTimestamp","type","id","loading","root","body","Component","arrayOf","shape","number","bool","oneOfType"],"mappings":"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","file":"index.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\nimport isBlank from 'ringcentral-integration/lib/isBlank';\n\nimport styles from './styles.scss';\n\nexport function Message({\n  subject,\n  time,\n  direction,\n  sender,\n  subjectRenderer: SubjectRenderer,\n  mmsAttachment,\n}) {\n  let content;\n  if (subject && !isBlank(subject)) {\n    content = SubjectRenderer ? <SubjectRenderer subject={subject} /> : subject;\n  } else if (mmsAttachment && mmsAttachment.contentType.indexOf('image') > -1) {\n    content = (<img src={mmsAttachment.uri} alt=\"attactment\" className={styles.picture} />);\n  }\n  return (\n    <div className={styles.message}>\n      {\n        time ?\n          (\n            <div className={styles.time}>\n              {time}\n            </div>\n          ) :\n          null\n      }\n      {\n        (sender && direction === 'Inbound') ?\n          (\n            <div className={styles.sender}>\n              {sender}\n            </div>\n          ) :\n          null\n      }\n      <div\n        className={classnames(\n          styles.messageBody,\n          direction === 'Outbound' ? styles.outbound : styles.inbound,\n          (subject && subject.length > 500) && styles.big,\n        )}>\n        { content }\n      </div>\n      <div className={styles.clear} />\n    </div>\n  );\n}\n\nMessage.propTypes = {\n  direction: PropTypes.string.isRequired,\n  subject: PropTypes.string,\n  time: PropTypes.string,\n  sender: PropTypes.string,\n  subjectRenderer: PropTypes.func,\n  mmsAttachment: PropTypes.object,\n};\n\nMessage.defaultProps = {\n  subject: '',\n  sender: undefined,\n  time: undefined,\n  subjectRenderer: undefined,\n  mmsAttachment: null,\n};\n\nclass ConversationMessageList extends Component {\n  componentDidMount() {\n    this.scrollToLastMessage();\n  }\n\n  componentDidUpdate(previousProps) {\n    if (\n      previousProps.messages.length === this.props.messages.length\n    ) {\n      return;\n    }\n    if (!this._scrollUp) {\n      this.scrollToLastMessage();\n    } else if (\n      this._listRef &&\n      this._scrollHeight !== this._listRef.scrollHeight\n    ) {\n      this._listRef.scrollTop =\n        this._listRef.scrollTop + (this._listRef.scrollHeight - this._scrollHeight);\n    }\n  }\n\n  onScroll = async () => {\n    if (!this._listRef) {\n      return;\n    }\n    const currentScrollTop = this._listRef.scrollTop;\n    this._scrollHeight = this._listRef.scrollHeight;\n    const clientHeight = this._listRef.clientHeight;\n    if (currentScrollTop < this._scrollTop) {\n      // user scroll up\n      this._scrollUp = true;\n    } else if (currentScrollTop + clientHeight > this._scrollHeight - 200) {\n      // user scroll down to bottom\n      this._scrollUp = false;\n    }\n    if (\n      currentScrollTop < 20 &&\n      this._scrollTop >= 20\n    ) {\n      this.props.loadPreviousMessages();\n    }\n    this._scrollTop = currentScrollTop;\n  }\n\n  scrollToLastMessage = () => {\n    if (this._listRef) {\n      this._listRef.scrollTop = this._listRef.scrollHeight;\n    }\n  }\n\n  render() {\n    const {\n      className,\n      dateTimeFormatter,\n      messages,\n      showSender,\n      height,\n      messageSubjectRenderer,\n      formatPhone,\n      loadingNextPage,\n    } = this.props;\n\n    let lastDate = 0;\n    const messageList = messages.map((message) => {\n      const sender = showSender ?\n        (\n          message.from.name ||\n          formatPhone(message.from.extensionNumber || message.from.phoneNumber)\n        ) :\n        null;\n      const date = new Date(message.creationTime);\n      const time = (date - lastDate < 60 * 60 * 1000 && date.getHours() === lastDate.getHours()) ?\n        null :\n        dateTimeFormatter({ utcTimestamp: message.creationTime, type: 'long' });\n      lastDate = date;\n      return (\n        <Message\n          key={message.id}\n          sender={sender}\n          time={time}\n          direction={message.direction}\n          subject={message.subject}\n          subjectRenderer={messageSubjectRenderer}\n          mmsAttachment={message.mmsAttachment}\n        />\n      );\n    });\n    const loading = loadingNextPage ? (\n      <div className={styles.loading}>\n        Loading...\n      </div>\n    ) : null;\n    return (\n      <div\n        className={classnames(styles.root, className)}\n        style={{ height }}\n        ref={(body) => { this._listRef = body; }}\n        onScroll={this.onScroll}\n      >\n        {loading}\n        {messageList}\n      </div>\n    );\n  }\n}\n\nConversationMessageList.propTypes = {\n  messages: PropTypes.arrayOf(PropTypes.shape({\n    creationTime: PropTypes.number,\n    id: PropTypes.number,\n    direction: PropTypes.string,\n    subject: PropTypes.string,\n    mmsAttachment: PropTypes.object,\n  })).isRequired,\n  className: PropTypes.string,\n  showSender: PropTypes.bool,\n  dateTimeFormatter: PropTypes.func.isRequired,\n  messageSubjectRenderer: PropTypes.func,\n  formatPhone: PropTypes.func.isRequired,\n  loadPreviousMessages: PropTypes.func,\n  loadingNextPage: PropTypes.bool,\n  height: PropTypes.oneOfType([PropTypes.number, PropTypes.string])\n};\n\nConversationMessageList.defaultProps = {\n  className: null,\n  showSender: false,\n  messageSubjectRenderer: undefined,\n  height: '100%',\n  loadingNextPage: false,\n  loadPreviousMessages: () => null,\n};\n\nexport default ConversationMessageList;\n"]}